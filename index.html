<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nepal Tax & Accounting AI</title>
    <style>
        :root { --primary: #2d6cdf; --bg: #f0f2f5; --accent: #e74c3c; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background: var(--bg); color: #333; }
        nav { background: var(--primary); color: white; padding: 1.2rem; text-align: center; font-weight: bold; font-size: 1.4rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .container { max-width: 850px; margin: 20px auto; padding: 0 15px; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 25px; border-top: 5px solid var(--primary); }
        h3 { margin-top: 0; color: var(--primary); display: flex; align-items: center; gap: 10px; }
        input, select, textarea, button { width: 100%; padding: 14px; margin-top: 12px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; font-size: 1rem; }
        button { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 20px; }
        button:hover { background: #1e4ea1; transform: translateY(-2px); }
        #aiResult { margin-top: 20px; padding: 20px; background: #fff; border: 1px solid #eee; border-left: 5px solid var(--accent); border-radius: 8px; white-space: pre-wrap; line-height: 1.6; font-size: 0.95rem; }
        .loading { color: #f39c12; font-weight: bold; animation: blink 1s infinite; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        .helper-text { font-size: 0.85rem; color: #666; margin-bottom: 10px; }
    </style>
</head>
<body>

<nav>üá≥üáµ Nepal Tax & Accounting AI Assistant</nav>

<div class="container">
    <div class="card">
        <h3>üìä Quick VAT Calculator</h3>
        <p class="helper-text">Calculate 13% VAT for Nepal.</p>
        <input type="number" id="vatAmt" placeholder="Enter Amount (NPR)">
        <select id="vatType">
            <option value="exclusive">VAT Exclusive (Add 13%)</option>
            <option value="inclusive">VAT Inclusive (Extract 13%)</option>
        </select>
        <button onclick="calcVAT()">Calculate Figures</button>
        <div id="vatResult" style="margin-top:15px; font-weight:bold; font-size: 1.1rem; color: #2c3e50;"></div>
    </div>

    <div class="card">
        <h3>üìù Journal Entry & Tax Expert</h3>
        <p class="helper-text">Example: "Purchased laptop for 1 lakh from VAT shop" or "Rent payment 50k to individual"</p>
        <textarea id="aiQ" rows="5" placeholder="Write your accounting question or transaction here..."></textarea>
        <button id="askBtn" onclick="askAI()">Generate Entry / Get Advice</button>
        <div id="aiResult">AI response will appear here with Journal Entries and Nepal Law references...</div>
    </div>
</div>

<script>
// Logic for VAT Calculation
function calcVAT(){
    let amt = parseFloat(document.getElementById('vatAmt').value);
    let type = document.getElementById('vatType').value;
    if(isNaN(amt)) return alert("Please enter a valid amount");

    let base, vat, total;
    if(type === "exclusive"){
        vat = amt * 0.13;
        base = amt;
        total = amt + vat;
    } else {
        base = amt / 1.13;
        vat = amt - base;
        total = amt;
    }
    document.getElementById('vatResult').innerHTML = `
        Base Amount: Rs. ${base.toLocaleString(undefined, {minimumFractionDigits: 2})} <br>
        VAT (13%): Rs. ${vat.toLocaleString(undefined, {minimumFractionDigits: 2})} <br>
        Total Amount: Rs. ${total.toLocaleString(undefined, {minimumFractionDigits: 2})}
    `;
}

// Logic for AI Expert using OpenRouter
async function askAI(){
    const question = document.getElementById('aiQ').value;
    const resultDiv = document.getElementById('aiResult');
    const btn = document.getElementById('askBtn');

    if(!question) return alert("Please type a question!");

    resultDiv.innerHTML = "<span class='loading'>üîÑ Analyzing Nepal Tax Laws & Generating Entries...</span>";
    btn.disabled = true;

    try {
        const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
            method: "POST",
            headers: {
                "Authorization": "Bearer YOUR_OPENROUTER_API_KEY", // <--- Afno API Key yaha hala
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                "model": "google/gemini-2.0-flash-exp:free",
                "messages": [
                    {
                        "role": "system",
                        "content": `You are a professional Chartered Accountant (CA) of Nepal. 
                        Your task is to provide Journal Entries, VAT calculations, and TDS advice strictly based on:
                        1. **Income Tax Act, 2058** and **VAT Act, 2052**.
                        2. **TDS Rates**: Service (VAT): 1.5%, Service (No VAT): 15%, Rent: 10%, Consultancy: 15%, Meeting Fee: 15%.
                        3. **VAT**: 13%.
                        4. **Journal Entry**: Provide in Dr/Cr table format with Narration.
                        5. **Salary Tax**: Use current Nepal Tax Slabs (1% SST, etc.).
                        6. **Language**: Use English with Roman Nepali explanations.`
                    },
                    {
                        "role": "user",
                        "content": question
                    }
                ]
            })
        });

        const data = await response.json();
        if(data.choices && data.choices[0]) {
            resultDiv.innerHTML = data.choices[0].message.content;
        } else {
            resultDiv.innerHTML = "Error: API Response issue. Check your Key.";
        }
    } catch (error) {
        resultDiv.innerHTML = "Error: System busy or Network issue. Please try again.";
    } finally {
        btn.disabled = false;
    }
}
</script>

</body>
</html>
